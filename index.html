<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Retrace - Configurable retrying.</title>
      
      
        <meta name="description" content="Configurable retrying.">
      
      
        <link rel="canonical" href="http://d0ugal.github.io/retrace/">
      
      
        <meta name="author" content="Dougal Matthews">
      
    
    <meta property="og:url" content="http://d0ugal.github.io/retrace/">
    <meta property="og:title" content="Retrace">
    <meta property="og:image" content="http://d0ugal.github.io/retrace//./">
    <meta name="apple-mobile-web-app-title" content="Retrace">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="./assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="./assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('./assets/fonts/icon.eot?52m981');
      	src: url('./assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('./assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('./assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('./assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="./assets/stylesheets/application-a422ff04cc.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Roboto', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="./assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
          </span>
        
        Retrace
      </div>
    </div>
    
      
      <div class="button button-twitter" role="button" aria-label="Twitter">
        <a href="https://twitter.com/d0ugal" title="@d0ugal on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
      </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/d0ugal" title="@d0ugal on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/d0ugal/retrace" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Retrace
          <span class="version">
            2.2.7.dev2
          </span>
        </strong>
        
          <br>
          d0ugal/retrace
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/d0ugal/retrace/archive/2.2.7.dev2.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/d0ugal/retrace/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="current" title="Home" href=".">
      Home
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Installation" href="#installation">
                Installation
              </a>
            </li>
          
            <li class="anchor">
              <a title="Usage Examples" href="#usage-examples">
                Usage Examples
              </a>
            </li>
          
            <li class="anchor">
              <a title="Custom Retry Handling" href="#custom-retry-handling">
                Custom Retry Handling
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
              
              <li>
                <a href="https://twitter.com/d0ugal" target="_blank" title="@d0ugal on Twitter">
                  @d0ugal on Twitter
                </a>
              </li>
            
            
              
              <li>
                <a href="https://github.com/d0ugal" target="_blank" title="@d0ugal on GitHub">
                  @d0ugal on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="retrace-configurable-elegant-retrying">Retrace - Configurable, elegant retrying<a class="headerlink" href="#retrace-configurable-elegant-retrying" title="Permanent link">¶</a></h1>
<p><a href="https://pypi.python.org/pypi/retrace"><img alt="PyPI Downloads" src="https://img.shields.io/pypi/dm/retrace.png" /></a>
<a href="https://pypi.python.org/pypi/retrace"><img alt="PyPI Version" src="https://img.shields.io/pypi/v/retrace.png" /></a>
<a href="https://travis-ci.org/d0ugal/retrace"><img alt="Build Status" src="https://img.shields.io/travis/d0ugal/retrace/master.png" /></a>
<a href="http://codecov.io/github/d0ugal/retrace?branch=master"><img alt="Coverage Status" src="http://codecov.io/github/d0ugal/retrace/coverage.svg?branch=master" /></a>
<a href="https://landscape.io/github/d0ugal/retrace/master"><img alt="Landscale Code Health" src="https://landscape.io/github/d0ugal/retrace/master/landscape.svg?style=flat-square" /></a></p>
<p>Dealing with some unstable code? Be it a bad connection or a system that often
falls over, retrace is here to help. Simple, easy, elegant and configurable
method retrying with a nice clean API.</p>
<p>Don't manually fudge around with exception retrying again!</p>
<p>Retrace supports Python 2.7 and 3.3+.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">¶</a></h2>
<h3 id="install-from-pip">Install from pip<a class="headerlink" href="#install-from-pip" title="Permanent link">¶</a></h3>
<p>Installation from pip is simple, like so:</p>
<div class="code"><pre><span></span>pip install retrace
</pre></div>


<h3 id="vendoring">Vendoring<a class="headerlink" href="#vendoring" title="Permanent link">¶</a></h3>
<p>If you don't want to add a new dependency for such a small tool, you are in
luck! Retrace is <strong>designed to be easily vendor-able!</strong> Simply head to the
<a href="https://github.com/d0ugal/retrace">GitHub repo</a>, grab the <code>retrace.py</code> file
and include it in your project tree. Then, for example, say you add it under
<code>myproject.utils.retrace</code> then you just need to use that import path in the
examples below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you choose to vendor retrace, you will need to manually version it
yourself. We recommend that you pick the latest git tag to get the most
recent stable version.</p>
</div>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">¶</a></h2>
<h3 id="retry-all-exceptions">Retry all exceptions<a class="headerlink" href="#retry-all-exceptions" title="Permanent link">¶</a></h3>
<p>If you want to retry a function call on any exception you can use the decorator
with no arguments. <strong>By default this will retry 5 times.</strong></p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">retrace</span>

<span class="nd">@retrace.retry</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default this will catch all subclasses of Exception, meaning it wont
catch a anything that subclasses BaseException directly like
KeyboardInterupt.</p>
</div>
<h3 id="retry-on-a-specific-exception-type">Retry on a specific exception type<a class="headerlink" href="#retry-on-a-specific-exception-type" title="Permanent link">¶</a></h3>
<p>Retry when an IOError is raised or any subclasses of it.</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">retrace</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">on_exeption</span><span class="o">=</span><span class="ne">IOError</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<h3 id="delaying-between-retries">Delaying between retries<a class="headerlink" href="#delaying-between-retries" title="Permanent link">¶</a></h3>
<p>If you want to delay between retries you can pass in a number which is equal
to the number of seconds to delay between retrying. For example, wait a second
between attempts</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">retrace</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<h3 id="limit-the-number-of-attempts">Limit the number of attempts<a class="headerlink" href="#limit-the-number-of-attempts" title="Permanent link">¶</a></h3>
<p>By default retrace will retry <strong>5 times</strong>, if you want to change that, pass in
a new limit.</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">retrace</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<h3 id="gradually-delay-more-between-attempts">Gradually delay more between attempts<a class="headerlink" href="#gradually-delay-more-between-attempts" title="Permanent link">¶</a></h3>
<p>Here is a neat trick - if you want to delay between each try, and have that
increase with each attempt you can pass <code>time.sleep</code> in as your interval
function! This will mean after the first attempt it will sleep for one second,
then two seconds, three seconds etc.</p>
<p>This works because you can use <a href="#custom-retry-
handling">functions as the delay</a>, they must accept one argument which is the current retry number. So
with <code>time.sleep</code>, the code sleeps for a the number of seconds equal to the
attempt number.</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">retrace</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<h3 id="validating-and-retrying-based-on-the-results">Validating and retrying based on the results<a class="headerlink" href="#validating-and-retrying-based-on-the-results" title="Permanent link">¶</a></h3>
<p>Sometimes you will have functions that don't error, but return bad values or
you might need to call it until you get a good value. You can achieve this
with validators.</p>
<p>In The following example, we have a function that returns a good value half
of the time, we want to retry unless the result matches what we expected.</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">retrace</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="s1">&#39;WANTED VALUE&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;WANTED VALUE&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;BAD VALUE&#39;</span>
</pre></div>


<h2 id="custom-retry-handling">Custom Retry Handling<a class="headerlink" href="#custom-retry-handling" title="Permanent link">¶</a></h2>
<h3 id="limits-and-intervals">limits and intervals<a class="headerlink" href="#limits-and-intervals" title="Permanent link">¶</a></h3>
<p>Okay, we touched on this, but let's just state it here clearly. The retry
decorator takes two different arguments for controlling it's behaviour, limit
and interval. These are similar, but different. Limit controls how many times
we should retry before giving up. Interval controls how much delay happens
between retry attempts.</p>
<h3 id="controlling-the-interval-between-retries">Controlling the interval between retries<a class="headerlink" href="#controlling-the-interval-between-retries" title="Permanent link">¶</a></h3>
<p>Customising the interval, the delay between retries, is a breeze, if you have
some specific logic you want to implement.</p>
<p>For example, here is a exponential backoff. It will increase the delay between
each attempt. To do this, a method needs to be passed that accepts one
argument. The argument is the the current attempt integer.</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">retrace</span>

<span class="k">def</span> <span class="nf">exponential_backoff</span><span class="p">(</span><span class="n">attempt_number</span><span class="p">):</span>
    <span class="c1"># Increase the delay between attempts each time it fails. This function</span>
    <span class="c1"># sleeps for the number of seconds equal to the attempt number plus a random</span>
    <span class="c1"># percentage of that time again. So, for example, after the first failure it</span>
    <span class="c1"># sleeps between 1 and 2 seconds, then between 2 and 4, then 3 and 6 etc.</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">attempt_number</span> <span class="o">+</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">attempt_number</span><span class="p">))</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">exponential_backoff</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<h3 id="limiting-the-number-of-reties">Limiting the number of reties<a class="headerlink" href="#limiting-the-number-of-reties" title="Permanent link">¶</a></h3>
<p>Similarly, the same approach can be used to limit the number of retries. In
this artificial example, the retry limit is 10 in the afternoon, but only 5
in them morning.</p>
<div class="code"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">retrace</span>

<span class="k">def</span> <span class="nf">try_more_in_the_afternoon</span><span class="p">(</span><span class="n">attempt_number</span><span class="p">):</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">attempt_number</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">retrace</span><span class="o">.</span><span class="n">LimitReached</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">attempt_number</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">retrace</span><span class="o">.</span><span class="n">LimitReached</span><span class="p">()</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">try_more_in_the_afternoon</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<h3 id="custom-validators">Custom Validators<a class="headerlink" href="#custom-validators" title="Permanent link">¶</a></h3>
<p>Validators are used to verify that the result from the function passes a
check.</p>
<p>If it isn't a callable, it can be any object that is then compared with the
result. Check that the function returns the value "EXPECTED".</p>
<div class="code"><pre><span></span><span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="s2">&quot;EXPECTED&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>


<p>Provide a custom validator that checks for type, rather than a full match.</p>
<div class="code"><pre><span></span><span class="k">def</span> <span class="nf">validate_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

<span class="nd">@retrace.retry</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">validate_string</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="c1"># ...</span>
</pre></div>
          <aside class="copyright" role="note">
            
              <a href="http://www.dougalmatthews.com/">Dougal Matthews</a> &ndash;
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '.';
      var repo_id  = 'd0ugal/retrace';
    </script>
    <script src="./assets/javascripts/application-997097ee0c.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-89549313-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>